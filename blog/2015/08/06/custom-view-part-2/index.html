
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Custom view- Part 2 - 80/20</title>
	<meta name="author" content="Shem Magnezi">


	<meta name="description" content="Custom View- Part 2 In part 1 we learned how to build a simple custom view that&rsquo;s integrate nicely with our pager view and show some &hellip;">


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="80/20" type="application/atom+xml">

	<link rel="canonical" href="http://shem8.github.io/blog/2015/08/06/custom-view-part-2/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>


	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-78073130-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">

	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("smagnezi8@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>

</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">

			<a class="email" href="mailto:smagnezi8@gmail.com" title="Email">Email</a>



			<a class="medium" href="https://medium.com/@shemag8" title="Medium">Medium</a>


			<a class="github" href="https://github.com/shem8" title="GitHub">GitHub</a>


			<a class="twitter" href="http://twitter.com/shemag8" title="Twitter">Twitter</a>












			<a class="rss" href="/atom.xml" title="RSS">RSS</a>

	</div>
</nav>
</header>
			</div>
		</div>
		<div class="mid-col">



			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Custom View- Part 2</h1>
	<div class="entry-content" itemprop="articleBody"><h5><em>In <a href="https://shem8.wordpress.com/2015/07/31/custom-view-part-1/">part 1</a> we learned how to build a simple custom view that&rsquo;s integrate nicely with our pager view and show some indication about the current page, in this post we&rsquo;ll take the view to the next level and add some subviews for page headers</em></h5>

<!--more-->


<hr />

<p>So we have simple nice looking pager indicator that animate smoothly when moving between tabs, but it&rsquo;s still missing some info about the tabs- something like the pages titles. So we&rsquo;ll add some subviews as the page titles and make them a bit interactive to show the selected page.
Why I plan to use subviews instead of just drawing the text straight on the canvas?</p>

<ul>
<li><p>When drawing text you need to handle the text position, text size line breaking etc&hellip; Lets focus on building the view and let Android save us time by using TextView.</p></li>
<li><p>When using subview we also save code on handling click events.</p></li>
<li><p>By adding subviews we make ourselves use ViewGroup and learn how to handle layout and measure parent and child views, and we&rsquo;re all here to learn right? =)</p></li>
</ul>


<h1>0. Setup</h1>

<p>Let make our PagerIndicatorView to extends ViewGroup so we&rsquo;ll be able to add sub views:</p>

<p>[code language=&ldquo;java&rdquo;]
public class PagerIndicatorView extends ViewGroup {
[/code]</p>

<p>Here is some tricky part that first I&rsquo;ve been waste couple of good hours debugging: view groups are usually not showing real UI, it just contains sub views and responsible to arrange them in the right order and layout, So by default the onDraw is skipped for ViewGroup. That&rsquo;s not the case for our view, so we need to disable it:</p>

<p>[code language=&ldquo;java&rdquo;]
public void init() {
    &hellip;
    setWillNotDraw(false);
}
[/code]</p>

<p>That&rsquo;s it, our view is now officially became a ViewGroup and we&rsquo;re able to add it child views</p>

<h1>1. Add the child views</h1>

<p>Lets add the page titles, it will be a simple TextViews with the numbers:</p>

<p>[code language=&ldquo;java&rdquo;]
public void init() {
    &hellip;
    addView(getTextView(&ldquo;1&rdquo;));
    addView(getTextView(&ldquo;2&rdquo;));
    addView(getTextView(&ldquo;3&rdquo;));
    addView(getTextView(&ldquo;4&rdquo;));
}</p>

<p>private TextView getTextView(String text) {
    TextView v = new TextView(getContext());
    v.setText(text);
    v.setTextSize(30);
    v.setGravity(Gravity.CENTER);
    return v;
}
[/code]</p>

<p>Now it&rsquo;s the time for putting the text views in the right position and size inside the view.</p>

<p>First lets start by setting them the right size- each text view should be &frac14; from the view width and the same as the view height. The measurement mechanism in view is done in the <a href="http://developer.android.com/reference/android/view/View.html#onMeasure(int,%20int">onMeasure</a>) method and it is a bit tricky- uses something called <a href="http://developer.android.com/reference/android/view/View.MeasureSpec.html">measure spec</a>. I would recommend you to read about it, but it basically define the size and the mode of the view. For easy handling it- the framework supply the developers couple of helper methods for reading and creating specs:</p>

<p>[code language=&ldquo;java&rdquo;]
@Override
protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
    final int width = getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec);
    final int childWidth = width / 4;
    final int height = getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec);
    for (int i = 0; i &amp;lt; getChildCount(); i++) {
        getChildAt(i).measure(View.MeasureSpec.makeMeasureSpec(childWidth, View.MeasureSpec.EXACTLY), View.MeasureSpec.makeMeasureSpec(height, View.MeasureSpec.EXACTLY));
    }
    setMeasuredDimension(width, height);
}
[/code]</p>

<p>Now for positioning the child views in the right places, this is done in the <a href="http://developer.android.com/reference/android/view/View.html#onLayout(boolean,%20int,%20int,%20int,%20int">onLayout</a>) method, we&rsquo;ll just go over the child views and position each child in the right offset:</p>

<p>[code language=&ldquo;java&rdquo;]
@Override
protected void onLayout(boolean changed, int left, int top, int right, int bottom) {
    final int childW = (right - left) / 4;
    final int childH = (bottom - top);
    for (int i = 0; i &amp;lt; getChildCount(); i++) {
        getChildAt(i).layout(i * childW, 0, (i + 1) * childW, childH);
    }
}
[/code]</p>

<p>Now you should get something like this:</p>

<p><a href="https://shem8.files.wordpress.com/2015/08/screen.png"><img src="https://shem8.files.wordpress.com/2015/08/screen-e1438861347399.png" alt="screen" /></a></p>

<h1>2. Interactive</h1>

<p>So we have titles for all pages, but how about make it clear which page is selected (beside the background color I mean)? Lets make out view a little bit more interactive, cause you now what the say- god is in the details.</p>

<p>We want to make the texts enlarge and be for strong when scrolling to the page:</p>

<p>[code language=&ldquo;java&rdquo;]
@Override
protected void onDraw(Canvas canvas) {
    &hellip;
    for (int i = 0; i &amp;lt; getChildCount(); i++) {
        final View view = getChildAt(i);
        if (i == index) {
            view.setScaleX(1 - Math.abs(prec) * 0.3f);
            view.setScaleY(1 - Math.abs(prec) * 0.3f);
            view.setAlpha(1 - Math.abs(prec) * 0.5f);
        } else if (i == index + 1) {
            view.setScaleX(0.7f + Math.abs(prec) * 0.3f);
            view.setScaleY(0.7f + Math.abs(prec) * 0.3f);
            view.setAlpha(0.5f + Math.abs(prec) * 0.5f);
        } else {
            view.setScaleX(0.7f);
            view.setScaleY(0.7f);
            view.setAlpha(0.5f);
        }
    }
}
[/code]</p>

<p>And wallah:</p>

<p><a href="https://shem8.files.wordpress.com/2015/08/final.gif"><img src="https://shem8.files.wordpress.com/2015/08/final.gif" alt="final" /></a></p>

<hr />

<h3>You can find the whole code in my <a href="https://github.com/shem8/customviewpager">git repository</a>, have fun!</h3>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">

	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>


	<a class="addthis_button_tweet"></a>


	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Post ad -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5508892730714185"
     data-ad-slot="8917228557"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2016

    Shem Magnezi


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>


<script type="text/javascript">
      var disqus_shortname = 'shemblog';


        // var disqus_developer = 1;
        var disqus_identifier = 'http://shem8.github.io/blog/2015/08/06/custom-view-part-2/';
        var disqus_url = 'http://shem8.github.io/blog/2015/08/06/custom-view-part-2/';
        var disqus_script = 'embed.js';

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
