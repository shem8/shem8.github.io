
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Android Drag and Drop - 80/20</title>
	<meta name="author" content="Shem Magnezi">

	
	<meta name="description" content="Android Drag and Drop Although Android system has a very good built-in drag &amp; drop mechanism, I seeing lots of libraries that just duplicate &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="80/20" type="application/atom+xml">
	
	<link rel="canonical" href="http://shem8.github.io/blog/2015/09/04/android-drag-and-drop/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-78073130-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("smagnezi8@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href="mailto:smagnezi8@gmail.com" title="Email">Email</a>
		
		
		
		
			<a class="twitter" href="http://twitter.com/shemag8" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/shem8" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Android Drag and Drop</h1>
	<div class="entry-content" itemprop="articleBody"><p><em>Although Android system has a very good <a href="http://developer.android.com/guide/topics/ui/drag-drop.html">built-in drag &amp; drop mechanism</a>, I seeing lots of libraries that just duplicate this behaviour, or users that hack they way for building drag &amp; drop on their apps. In this blog post I will explain how to implement a simple drag &amp; drop functionality between different views with a very small amount of code.</em></p>

<!--more-->


<h1>0. Setup</h1>

<p>For our example we gonna build a simple 3x3 grid with a numbers from 1 to 9. Than the user will be able to drag and drop between those numbers and the result will be the multiplication of this 2 values on the dropped view.</p>

<p>So first, let build our view with the numbers:</p>

<p>[code language=&ldquo;xml&rdquo;]
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="20dp"
    tools:context=".MainActivityFragment"></p>

<pre><code>&lt;TextView
    android:id="@+id/text1"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="1"
    android:textSize="40sp"
    android:layout_gravity="left|top" /&gt;

&lt;TextView
    android:id="@+id/text2"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="2"
    android:textSize="40sp"
    android:layout_gravity="center_horizontal|top" /&gt;

&lt;TextView
    android:id="@+id/text3"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="3"
    android:textSize="40sp"
    android:layout_gravity="right|top" /&gt;

&lt;TextView
    android:id="@+id/text4"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="4"
    android:textSize="40sp"
    android:layout_gravity="left|center_vertical" /&gt;

&lt;TextView
    android:id="@+id/text5"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="5"
    android:textSize="40sp"
    android:layout_gravity="center" /&gt;

&lt;TextView
    android:id="@+id/text6"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="6"
    android:textSize="40sp"
    android:layout_gravity="right|center_vertical" /&gt;

&lt;TextView
    android:id="@+id/text7"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="7"
    android:textSize="40sp"
    android:layout_gravity="left|bottom" /&gt;

&lt;TextView
    android:id="@+id/text8"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="8"
    android:textSize="40sp"
    android:layout_gravity="center_horizontal|bottom" /&gt;

&lt;TextView
    android:id="@+id/text9"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="9"
    android:textSize="40sp"
    android:layout_gravity="right|bottom" /&gt;
</code></pre>

<p></FrameLayout>
[/code]</p>

<h1>1. Dragging</h1>

<p>We&rsquo;ll setup each view to be draggable on long click:</p>

<p>[code language=&ldquo;java&rdquo;]
view.setOnLongClickListener(new View.OnLongClickListener() {
    @Override
        public boolean onLongClick(View v) {
            ClipData data = ClipData.newPlainText(&ldquo;value&rdquo;, view.getText());
            view.startDrag(data, new View.DragShadowBuilder(v), null, 0);
            return true;
        }
    });
}
[/code]</p>

<p>Couple of things to pay attention:</p>

<ul>
<li><p>We should pass the data of the view value to the drag and drop event for later use (to calculate the multiplication), we&rsquo;re doing it by using <a href="http://developer.android.com/reference/android/content/ClipData.html">ClipData</a>.</p></li>
<li><p>We should show some indication about the dragging- that&rsquo;s what the <a href="http://developer.android.com/reference/android/view/View.DragShadowBuilder.html">DragShadowBuilder</a> for, by default he&rsquo;s drawing the view image on dragging position. You can use it for drawing another image or some other indication.</p></li>
<li><p>When we&rsquo;re ready we call startDrag. Yap, that&rsquo;s simple.</p></li>
</ul>


<h1>2. Dropping</h1>

<p>Now for the other side of the Drag&amp;Drop- the drop. Again, we&rsquo;ll setup each view with a drag listener:</p>

<p>[code language=&ldquo;java&rdquo;]
        view.setOnDragListener(new View.OnDragListener() {
            @Override
            public boolean onDrag(View v, DragEvent event) {
                switch(event.getAction()) {
                    case DragEvent.ACTION_DRAG_STARTED:
                        return true;</p>

<pre><code>                case DragEvent.ACTION_DRAG_ENTERED:
                    v.setBackgroundColor(Color.LTGRAY);
                    return true;

                case DragEvent.ACTION_DRAG_LOCATION:
                    return true;

                case DragEvent.ACTION_DRAG_EXITED:
                    v.setBackgroundColor(Color.TRANSPARENT);
                    return true;

                case DragEvent.ACTION_DROP:
                    v.setBackgroundColor(Color.TRANSPARENT);
                    int dragVal = Integer.parseInt(event.getClipData().getItemAt(0).getText().toString());
                    int viewVal = Integer.parseInt(((TextView) v).getText().toString());
                    ((TextView) v).setText("" + (dragVal + viewVal));
                    return true;

                case DragEvent.ACTION_DRAG_ENDED:
                    return true;

                default:
                    break;
            }
            return false;
        }
    });
</code></pre>

<p>[/code]</p>

<p>OMG THAT&rsquo;S SO MUCH CODE! AND WITH A SWITCH CASE!! YOU PROMISE IT SHOULD BE SIMPLE!!!
Ok ok, please calm down, take a glass of bear and sit down. Actually the drag handling is pretty simple there just a bit of boilerplate code (cause you know, java&hellip;)</p>

<p>Lets&rsquo;s go over all the actions in the drag event we should handle <strong>(remember, this listener is on the dropped view and all those actions related to this view, please don&rsquo;t confused between the dragged view and the dropped view):</strong></p>

<ul>
<li><p>ACTION_DRAG_STARTED- that&rsquo;s mean that there is some other view in the screen that is start dragging. If we want this other view will be able to be dropped on our view we should return &ldquo;true&rdquo;, if we&rsquo;ll return &ldquo;false&rdquo; all the dragging and dropping flow won&rsquo;t be relevant (and the related events won&rsquo;t be delivered).</p></li>
<li><p>ACTION_DRAG_ENTERED- the dragged view was entered to our view area, usually we should show some indication here (like changing the background color on our case)</p></li>
<li><p>ACTION_DRAG_LOCATION- that&rsquo;s mean that the dragging view is changing his location within our view area, not much to do here, so just ignore.</p></li>
<li><p>ACTION_DRAG_EXITED- the dragged view was exited from our view area, again- indication should be show here.</p></li>
<li><p>ACTION_DROP- an actual drop was committed on our view! Now&rsquo;s the time to do your logic (for our case putting the right value in the text box). Don&rsquo;t forget to reset your indication from the ACTION_DRAG_ENTERED event!</p></li>
<li><p>ACTION_DRAG_ENDED- the drag and drop flow was ended, but not on our view ( =( ). Again, not relevant on our case so we just ignore.</p></li>
</ul>


<p>Pretty simple right? This is how this should look like:</p>

<p><a href="https://shem8.files.wordpress.com/2015/09/draganddrop.gif"><img src="https://shem8.files.wordpress.com/2015/09/draganddrop.gif?w=180" alt="draganddrop" /></a></p>

<p>You can also find the full project source code in <a href="https://github.com/shem8/AndroidDragAndDrop">my github</a></p>

<p>_Credit for cover image: <a href="http://genius.com/1699408/Major-lazer-bubble-butt/I-aint-snoop-dogg-but-imma-drop-it-like-its-hot_">http://genius.com/1699408/Major-lazer-bubble-butt/I-aint-snoop-dogg-but-imma-drop-it-like-its-hot_</a></p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2016

    Shem Magnezi


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
